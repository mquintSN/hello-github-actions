name: Download file from azure
on: [workflow_dispatch, push]
jobs: 
  fetch_blob:
     name: Download file from azure
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v1
       - uses: actions/setup-node@v2
         with:
            node-version: '12'
       - run: npm install
       - uses: ./blob-fetch
         id: download_blob
         with:
           storage_account_name: sleepscience
           account_access_key: ${{ secrets.ACCOUNT_ACCESS_KEY }}
           container_name: states
           blob_prefix: us
           output_file: '../../results.json'
       - uses: DamianReeves/write-file-action@v1.0
         with:
          path: 'blob-fetch/results.json'
          contents: ${{steps.download_blob.outputs.success}}"
          write-mode: overwrite
       - name: Commit files  # transfer the new html files back into the repository
         run: |
          git config --local user.name  ${{ github.actor }}
          git add blob-fetch/results.json
          git commit -m "Updating the json file"
       - name: Push changes  # push the output folder to your repo
         uses: ad-m/github-push-action@master
         with:
          github_token: ${{ secrets.TOKEN }}
          force: true  

